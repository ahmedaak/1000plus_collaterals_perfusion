---
title: "Collaterals_1000plus_KV"
author: "Ahmed Khalil"
date: "21 May 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r, echo= FALSE, fig.width=6, fig.height=6, fig.align='center',dpi=300}
# necessary packages
library(robustbase)
library(knitr)

# load data
allpts <- read.table("Carmela_Project.csv", header = T, sep=",")

# create necessary variables (reperfusion / infarct growth binarized cut-offs)
allpts$reperf[allpts$relTmax_change<=-50] <- "Yes"
allpts$reperf[allpts$relTmax_change>-50] <- "No"
allpts$reperf <- factor(allpts$reperf)

# recode recanalization variable
allpts$Rekan[allpts$Rekan==0] <- "None" # no recanalization
allpts$Rekan[allpts$Rekan==1] <- "Full" # full recanalization
allpts$Rekan[allpts$Rekan==2] <- "Partial" # partial recanalization

# descriptive stats
kable(table(allpts$reperf, allpts$Rekan))
barplot(table(allpts$reperf, allpts$Rekan), legend.text = c("No reperfusion", "Reperfusion"), col=c("#1b9e77","#d95f02"), xlab="Recanalization", ylab="Number of patients", xpd=F,args.legend = list(x = "topleft"), ylim=c(0,80))

## TEST FOR DIFFERENCES B/W CATEGORICAL VARIABLES HERE ##

# check assumptions of ANCOVA
par(mfrow=c(2,2))
plot(lm(allpts$relTmax_change~allpts$Rekan + allpts$rel_DWIgrowth + allpts$circulation + allpts$TSI + allpts$NIHSS_ad))

# perform ANCOVA
summary(lm(allpts$relTmax_change~allpts$Rekan + allpts$rel_DWIgrowth + allpts$circulation + allpts$TSI + allpts$NIHSS_ad))

# check assumptions of robust GLM
par(mfrow=c(2,3))
plot(lmrob(allpts$relTmax_change~allpts$Rekan + allpts$rel_DWIgrowth + allpts$circulation + allpts$TSI + allpts$NIHSS_ad + allpts$iv_tPR))

# perform robust GLM
summary(lmrob(allpts$relTmax_change~allpts$Rekan + allpts$rel_DWIgrowth + allpts$circulation + allpts$TSI + allpts$NIHSS_ad + allpts$iv_tPR))

# test if circulation has influence on reperfusion in non-recanalizers
summary(lmrob(allpts[allpts$Rekan=="None",]$relTmax_change~allpts[allpts$Rekan=="None",]$circulation))

# test if circulation has influence on reperfusion in recanalizers (full OR partial)
summary(lmrob(allpts[allpts$Rekan=="Full"|allpts$Rekan=="Partial",]$relTmax_change~allpts[allpts$Rekan=="Full"|allpts$Rekan=="Partial",]$circulation))
```



```{r pressure, echo=FALSE}
```

